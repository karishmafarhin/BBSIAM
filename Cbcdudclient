echo "${/myPipelineRuntime/uDeployDetails}" > DeployDetails.json

Output=$(/appbin/Softwares/udclient/udclient -username ${/myPipeline/propertySheet/ReleaseManagement/uDeploy_Username} \
-password ${/myPipeline/propertySheet/ReleaseManagement/uDeploy_Password} \
-weburl ${/myPipeline/propertySheet/ReleaseManagement/uDeploy_Prod_WebUrl} \
requestApplicationProcess DeployDetails.json)

# Extract Application ID cleanly
Application_ID1=$(echo "$Output" | grep -oP '(?<="id":")[^"]+')
Application_ID=$(echo "$Application_ID1" | tr -d '{},')

echo "Application ID: $Application_ID"

# Set the property
ectool setProperty "/myPipelineRuntime/${/myStage}_uDeployRequestID" --value "$Application_ID"


echo "${/myPipelineRuntime/uDeployDetails}" > DeployDetails.json

# Run udclient command and capture the output
Output=$(/appbin/Softwares/udclient/udclient -username ${/myPipeline/propertySheet/ReleaseManagement/uDeploy_Username} \
-password ${/myPipeline/propertySheet/ReleaseManagement/uDeploy_Password} \
-weburl ${/myPipeline/propertySheet/ReleaseManagement/uDeploy_Prod_WebUrl} \
requestApplicationProcess DeployDetails.json)

# Print the full output for debugging
echo "Full Output:"
echo "$Output"

# Extract the Application ID by using a simpler approach
# Assuming the output contains something like "id: value"
Application_ID=$(echo "$Output" | grep -o '"id":[^,]*' | cut -d':' -f2 | tr -d '", ')

echo "Application ID: $Application_ID"

# Set the property in CloudBees CD
ectool setProperty "/myPipelineRuntime/${/myStage}_uDeployRequestID" --value "$Application_ID"
